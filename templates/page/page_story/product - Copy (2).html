
{% block content %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <!-- Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Select2 JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <!-- Folium Map (we'll embed an iframe) -->
    <style>
        body {
            display: flex;
            flex-direction: column;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        header {
            padding: 10px;
            background-color: #f8f9fa;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        main {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        .left-half {
            flex: 1;
            border-right: 1px solid #ccc;
        }
        .right-half {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .chart-container {
            flex: 1;
            padding: 10px;
        }
        footer {
            padding: 10px;
            background-color: #f1f1f1;
            text-align: center;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>
    <header>
        <select id="dropdown" style="width: 200px;">
            <option value="1">Option 1</option>
            <option value="2">Option 2</option>
            <option value="3">Option 3</option>
        </select>
        <button id="search-btn">Search</button>
    </header>
    <main>
        <div class="left-half">
            <!-- Folium map placeholder -->
            <iframe src="zipcodemap.html" id="map-frame"></iframe>
        </div>
        <div class="right-half">
            <div class="chart-container">
                <canvas id="line-chart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="bar-chart"></canvas>
            </div>
        </div>
    </main>
    <footer>
        <!-- Empty Footer -->
    </footer>

    <script>
        // Initialize Select2
        $(document).ready(function() {
            $('#dropdown').select2();
        });

        // Line Chart
        const lineCtx = document.getElementById('line-chart').getContext('2d');
        const lineChart = new Chart(lineCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Line Dataset',
                    data: [10, 20, 15, 30, 25, 35],
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 2,
                    fill: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });

        // Bar Chart
        const barCtx = document.getElementById('bar-chart').getContext('2d');
        const barChart = new Chart(barCtx, {
            type: 'bar',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Bar Dataset',
                    data: [12, 19, 3, 5, 2, 3],
                    backgroundColor: 'rgba(153, 102, 255, 0.6)',
                    borderColor: 'rgba(153, 102, 255, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });

        // Get the button element
        const button = document.getElementById('search-btn');
        const map_frame = document.getElementById('map-frame');
        
        // Add a click event listener to the button
        button.addEventListener('click', function() {
            map_frame.src = map_frame.src // Reloads the current page
            
            const selectedValue = $('#dropdown').val(); // Get selected value

            if (selectedValue) {
                prompt('You selected:', selectedValue); // Show the selected value in a prompt
            } else {
                alert('Please select an option first!');
            }
        });
        
        // Populate the Select 2 Dropdown list
        const api_endpoint_1 = location.protocol + '//' + location.host + '/region_api/list_zipcodes';

        fetch(api_endpoint_1)  // Replace with your real API URL
         .then(response => response.json())
         .then(data => {
        
        // Clear existing options
        $('#dropdown').empty();

        // Assuming data is like { ids: [1,2,3,4] }
        data.zipcodes.forEach(zipcode => {
          // Append new options
          var newOption = new Option(zipcode, zipcode, false, false);
          $('#dropdown').append(newOption);
        });

        // Refresh Select2 after adding options
        $('#dropdown').trigger('change');
      })
      .catch(error => {
        console.error('Error fetching options:', error);
        alert('Failed to fetch options.');
      });


    </script>
</body>
{% endblock %}